{"version":3,"file":"index.min.js","sources":["../src/utils.ts","../src/event.ts","../src/index.ts","../src/loader.ts"],"sourcesContent":["export const isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined'\n\nexport const getType = (value: any) =>\n\tObject.prototype.toString.call(value).slice(8, -1).toLowerCase()\n\nexport const isObject = (value: any) => getType(value) === 'object'\n\nexport function omit<T extends object, K extends keyof T>(obj: T, keys: K[]): Omit<T, K> {\n\tconst result = { ...obj }\n\tkeys.forEach((key) => {\n\t\tdelete result[key]\n\t})\n\treturn result\n}\n\n/**\n * query CanvasElement\n */\nexport function queryCanvas(canvas: string | HTMLCanvasElement): HTMLCanvasElement | null {\n\tif (canvas instanceof HTMLCanvasElement) {\n\t\treturn canvas\n\t}\n\treturn document.querySelector(canvas)\n}\n\nexport const log = (() => {\n\tconst prefix = '[unity-webgl]'\n\tconst _log = (...args: any[]) => console.log(prefix, ...args)\n\t_log.warn = (...args: any[]) => console.warn(prefix, ...args)\n\t_log.error = (...args: any[]) => console.error(prefix, ...args)\n\treturn _log\n})()\n","import { isBrowser } from './utils'\nimport { UnityInstance } from './types'\nimport type UnityWebgl from './index'\n\ninterface EventListener {\n\t(...args: any[]): void\n\t_?: EventListener\n}\ntype EventListenerOptions = {\n\tonce?: boolean\n}\ntype EventsMap = Record<string, EventListener[]>\ninterface UnityEventMap {\n\tbeforeMount: (instance: UnityWebgl) => void\n\tmounted: (instance: UnityWebgl, unityInstance: UnityInstance) => void\n\tbeforeUnmount: (instance: UnityWebgl) => void\n\tunmounted: () => void\n\tprogress: (progress: number) => void\n\tdebug: (msg: string) => void\n\terror: (error: string | Error) => void\n}\n\nexport class UnityWebglEvent {\n\tprivate _e: EventsMap // events map\n\n\tconstructor() {\n\t\tthis._e = {}\n\t\tif (isBrowser) {\n\t\t\t// Register Unity event trigger to the window object\n\t\t\twindow.dispatchUnityEvent = (name: string, ...args: any[]) => {\n\t\t\t\tif (!name.startsWith('unity:')) {\n\t\t\t\t\tname = `unity:${name}`\n\t\t\t\t}\n\t\t\t\tthis.emit.call(this, name, ...args)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Register event listener\n\t * @param name event name\n\t * @param listener event listener\n\t * @param options event listener options\n\t */\n\ton<K extends keyof UnityEventMap>(\n\t\tname: K,\n\t\tlistener: UnityEventMap[K],\n\t\toptions?: EventListenerOptions\n\t): this\n\ton(name: string, listener: EventListener, options?: EventListenerOptions): this\n\ton<K extends keyof UnityEventMap>(\n\t\tname: string | K,\n\t\tlistener: EventListener | UnityEventMap[K],\n\t\toptions?: EventListenerOptions\n\t) {\n\t\tif (typeof listener !== 'function') {\n\t\t\tthrow new TypeError('listener must be a function')\n\t\t}\n\n\t\tif (!this._e[name]) {\n\t\t\tthis._e[name] = []\n\t\t}\n\n\t\tif (options?.once) {\n\t\t\tconst onceListener = (...args: any[]) => {\n\t\t\t\tthis.off(name, onceListener)\n\t\t\t\tlistener.apply(this, args)\n\t\t\t}\n\t\t\tonceListener._ = listener\n\n\t\t\tthis._e[name].push(onceListener)\n\t\t} else {\n\t\t\tthis._e[name].push(listener)\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Remove event listener\n\t * @param name event name\n\t * @param listener event listener\n\t */\n\toff<K extends keyof UnityEventMap>(name: K, listener: UnityEventMap[K]): this\n\toff(name: string, listener: EventListener): this\n\toff<K extends keyof UnityEventMap>(\n\t\tname: string | K,\n\t\tlistener?: EventListener | UnityEventMap[K]\n\t) {\n\t\tif (!listener) {\n\t\t\tdelete this._e[name]\n\t\t} else {\n\t\t\tconst listeners = this._e[name]\n\t\t\tif (listeners) {\n\t\t\t\tthis._e[name] = listeners.filter((l) => l !== listener && l._ !== listener)\n\t\t\t}\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Dispatch event\n\t * @param name event name\n\t * @param args event args\n\t */\n\temit(name: string, ...args: any[]) {\n\t\tif (!this._e[name]) {\n\t\t\t// log.warn(`No listener for event ${name}`)\n\t\t\treturn this\n\t\t}\n\n\t\tthis._e[name].forEach((listener) => listener.apply(this, args))\n\t\treturn this\n\t}\n\n\t/**\n\t * clear all event listeners\n\t */\n\tprotected clear() {\n\t\tthis._e = {}\n\t}\n\n\t/**\n\t * Register event listener for unity client\n\t * @param name event name\n\t * @param listener event listener\n\t */\n\taddUnityListener(name: string, listener: EventListener, options?: EventListenerOptions) {\n\t\tif (!name.startsWith('unity:')) {\n\t\t\tname = `unity:${name}`\n\t\t}\n\t\treturn this.on(name, listener, options)\n\t}\n\n\t/**\n\t * Remove event listener from unity client\n\t * @param name event name\n\t * @param listener event listener\n\t */\n\tremoveUnityListener(name: string, listener?: EventListener) {\n\t\tif (!name.startsWith('unity:')) {\n\t\t\tname = `unity:${name}`\n\t\t}\n\t\treturn this.off(name, listener as EventListener)\n\t}\n}\n","import { UnityWebglEvent } from './event'\nimport { unityLoader } from './loader'\nimport { isBrowser, isObject, omit, queryCanvas, log } from './utils'\nimport { UnityConfig, UnityArguments, UnityInstance } from './types'\n\ntype CanvasElementOrString = HTMLCanvasElement | string\n\nfunction createUnityArgs(ctx: UnityWebgl, config: UnityConfig): UnityArguments {\n\tconst unityArgs: UnityArguments = omit(config, ['loaderUrl'])\n\tunityArgs.print = function (msg: string) {\n\t\tctx.emit('debug', msg)\n\t}\n\tunityArgs.printError = function (msg: string) {\n\t\tctx.emit('error', msg)\n\t}\n\treturn unityArgs\n}\n\nclass UnityWebgl extends UnityWebglEvent {\n\tprivate _config: UnityConfig\n\tprivate _unity: UnityInstance | null = null\n\tprivate _loader: (() => void) | null = null\n\tprivate _canvas: HTMLCanvasElement | null = null\n\n\tconstructor(canvas: CanvasElementOrString, config: UnityConfig)\n\tconstructor(config: UnityConfig)\n\tconstructor(canvas: CanvasElementOrString | UnityConfig, config?: UnityConfig) {\n\t\tsuper()\n\t\tif (!(typeof canvas === 'string' || canvas instanceof HTMLCanvasElement || isObject(canvas))) {\n\t\t\tthrow new TypeError('Parameter canvas is not valid')\n\t\t}\n\n\t\t// config\n\t\tif (isObject(canvas)) {\n\t\t\tconfig = canvas as UnityConfig\n\t\t}\n\t\tif (\n\t\t\t!config ||\n\t\t\t!config.loaderUrl ||\n\t\t\t!config.dataUrl ||\n\t\t\t!config.frameworkUrl ||\n\t\t\t!config.codeUrl\n\t\t) {\n\t\t\tthrow new TypeError('UnityConfig is not valid')\n\t\t}\n\t\tthis._config = config\n\n\t\t// canvas\n\t\tif (typeof canvas === 'string' || canvas instanceof HTMLCanvasElement) {\n\t\t\tthis.render(canvas)\n\t\t}\n\t}\n\n\t/**\n\t * @deprecated Use `render()` instead.\n\t */\n\tcreate(canvas: CanvasElementOrString): Promise<void> {\n\t\treturn this.render(canvas)\n\t}\n\n\t/**\n\t * Renders the UnityInstance into the target html canvas element.\n\t * @param canvas The target html canvas element.\n\t */\n\trender(canvas: CanvasElementOrString): Promise<void> {\n\t\tif (!isBrowser) return Promise.resolve()\n\n\t\tif (this._unity && this._canvas && this._loader) {\n\t\t\tlog.warn('UnityInstance already created')\n\t\t\treturn Promise.resolve()\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\ttry {\n\t\t\t\tconst $canvas = queryCanvas(canvas)\n\t\t\t\tif (!$canvas) {\n\t\t\t\t\tthrow new Error('CanvasElement is not found')\n\t\t\t\t}\n\t\t\t\tthis._canvas = $canvas\n\t\t\t\tconst ctx = this\n\t\t\t\t// Create UnityInstance Arguments\n\t\t\t\tconst unityArgs = createUnityArgs(this, this._config)\n\n\t\t\t\tthis.emit('beforeMount', this)\n\n\t\t\t\tthis._loader = unityLoader(this._config.loaderUrl, {\n\t\t\t\t\tresolve() {\n\t\t\t\t\t\twindow\n\t\t\t\t\t\t\t.createUnityInstance($canvas, unityArgs, (val: number) => ctx.emit('progress', val))\n\t\t\t\t\t\t\t.then((ins: UnityInstance) => {\n\t\t\t\t\t\t\t\tctx._unity = ins\n\t\t\t\t\t\t\t\tctx.emit('mounted', ctx, ins)\n\t\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\t\tthrow err\n\t\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\treject(err) {\n\t\t\t\t\t\tthrow err\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t} catch (err) {\n\t\t\t\tthis._unity = null\n\t\t\t\tthis.emit('error', err)\n\t\t\t\treject(err)\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Sends a message to the UnityInstance to invoke a public method.\n\t * @param {string} objectName Unity scene name.\n\t * @param {string} methodName public method name.\n\t * @param {any} value an optional method parameter.\n\t * @returns\n\t */\n\tsendMessage(objectName: string, methodName: string, value?: any) {\n\t\tif (!this._unity) {\n\t\t\tlog.warn('Unable to Send Message while Unity is not Instantiated.')\n\t\t\treturn this\n\t\t}\n\n\t\tif (value === undefined || value === null) {\n\t\t\tthis._unity.SendMessage(objectName, methodName)\n\t\t} else {\n\t\t\tconst _value = typeof value === 'object' ? JSON.stringify(value) : value\n\t\t\tthis._unity.SendMessage(objectName, methodName, _value)\n\t\t}\n\t\treturn this\n\t}\n\t/**\n\t * @deprecated Use `sendMessage()` instead.\n\t */\n\tsend(objectName: string, methodName: string, value?: any) {\n\t\treturn this.sendMessage(objectName, methodName, value)\n\t}\n\n\t/**\n\t * Asynchronously ask for the pointer to be locked on current canvas.\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/requestPointerLock\n\t */\n\trequestPointerLock(): void {\n\t\tif (!this._unity || !this._unity.Module.canvas) {\n\t\t\tlog.warn('Unable to requestPointerLock while Unity is not Instantiated.')\n\t\t\treturn\n\t\t}\n\t\tthis._unity.Module.canvas.requestPointerLock()\n\t}\n\n\t/**\n\t * Takes a screenshot of the canvas and returns a base64 encoded string.\n\t * @param {string} dataType Defines the type of screenshot, e.g \"image/jpeg\"\n\t * @param {number} quality Defines the quality of the screenshot, e.g 0.92\n\t * @returns A base 64 encoded string of the screenshot.\n\t */\n\ttakeScreenshot(dataType?: string, quality?: any): string | undefined {\n\t\tif (!this._unity || !this._unity.Module.canvas) {\n\t\t\tlog.warn('Unable to take Screenshot while Unity is not Instantiated.')\n\t\t\treturn\n\t\t}\n\n\t\treturn this._unity.Module.canvas.toDataURL(dataType, quality)\n\t}\n\n\t/**\n\t * Enables or disabled the Fullscreen mode of the Unity Instance.\n\t * @param {boolean} enabled\n\t */\n\tsetFullscreen(enabled: boolean) {\n\t\tif (!this._unity) {\n\t\t\tlog.warn('Unable to set Fullscreen while Unity is not Instantiated.')\n\t\t\treturn\n\t\t}\n\n\t\tthis._unity.SetFullscreen(enabled ? 1 : 0)\n\t}\n\n\t/**\n\t * Quits the Unity instance and clears it from memory so that Unmount from the DOM.\n\t */\n\tunload(): Promise<void> {\n\t\tif (!this._unity) {\n\t\t\tlog.warn('Unable to Quit Unity while Unity is not Instantiated.')\n\t\t\treturn Promise.reject()\n\t\t}\n\t\tthis.emit('beforeUnmount', this)\n\n\t\t// Unmount unity.loader.js from DOM\n\t\tif (typeof this._loader === 'function') {\n\t\t\tthis._loader()\n\t\t\tthis._loader = null\n\t\t}\n\t\t// Unmount unityInstance from memory\n\t\treturn this._unity\n\t\t\t.Quit()\n\t\t\t.then(() => {\n\t\t\t\tthis._unity = null\n\t\t\t\tthis._canvas = null\n\t\t\t\tthis.clear()\n\n\t\t\t\tthis.emit('unmounted')\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tlog.error('Unable to Unload Unity')\n\t\t\t\tthis.emit('error', err)\n\t\t\t\tthrow err\n\t\t\t})\n\t}\n\n\t/**\n\t * 保障Unity组件可以安全卸载. 在unity实例从内存中销毁之前保障Dom存在.\n\t *\n\t * Warning! This is a workaround for the fact that the Unity WebGL instances\n\t * which are build with Unity 2021.2 and newer cannot be unmounted before the\n\t * Unity Instance is unloaded.\n\t */\n\tunsafe_unload(): Promise<void> {\n\t\ttry {\n\t\t\tif (!this._unity || !this._unity.Module.canvas) {\n\t\t\t\tlog.warn('No UnityInstance found.')\n\t\t\t\treturn Promise.reject()\n\t\t\t}\n\t\t\t// Re-attaches the canvas to the body element of the document. This way it\n\t\t\t// wont be removed from the DOM when the component is unmounted. Then the\n\t\t\t// canvas will be hidden while it is being unloaded.\n\t\t\tconst canvas = this._unity.Module.canvas as HTMLCanvasElement\n\t\t\tdocument.body.appendChild(canvas)\n\t\t\tcanvas.style.display = 'none'\n\t\t\treturn this.unload().then(() => {\n\t\t\t\tcanvas.remove()\n\t\t\t})\n\t\t} catch (e) {\n\t\t\treturn Promise.reject(e)\n\t\t}\n\t}\n}\n\nexport default UnityWebgl\nexport * from './types'\n","import { isBrowser } from './utils'\n\ntype ScriptLoadedStatus = 'loaded' | 'error'\ntype UnityLoaderCallbackObj = {\n\tresolve: () => void\n\treject: (error: Error) => void\n}\n\n/**\n * Loading Unity Loader Scripts\n * @param src script src\n * @param callbacks callbacks\n */\nexport function unityLoader(\n\tsrc: string,\n\tcallbacks: UnityLoaderCallbackObj = {} as UnityLoaderCallbackObj\n) {\n\tconst { resolve, reject } = callbacks\n\n\tif (!isBrowser) return null\n\tif (!src) {\n\t\treject && reject(new Error(`${src} not found.`))\n\t\treturn null\n\t}\n\n\tfunction handler(code: ScriptLoadedStatus) {\n\t\tif (code === 'loaded') {\n\t\t\tresolve && resolve()\n\t\t} else {\n\t\t\treject && reject(new Error(`${src} loading failure.`))\n\t\t}\n\t}\n\n\tlet script: HTMLScriptElement | null = window.document.querySelector(`script[src=\"${src}\"]`)\n\n\tif (!script) {\n\t\tscript = window.document.createElement('script')\n\t\tscript.async = true\n\t\tscript.setAttribute('data-status', 'loading')\n\n\t\tfunction setAttrListener(status: ScriptLoadedStatus) {\n\t\t\tscript?.setAttribute('data-status', status)\n\t\t\thandler(status)\n\t\t}\n\t\tscript.addEventListener('load', () => setAttrListener('loaded'))\n\t\tscript.addEventListener('error', () => setAttrListener('error'))\n\n\t\tscript.src = src\n\t\twindow.document.body.appendChild(script)\n\t} else {\n\t\thandler(script.getAttribute('data-status') === 'loaded' ? 'loaded' : 'error')\n\t}\n\n\t// Return cleanup function\n\treturn function remove() {\n\t\tif (script && script.parentNode) {\n\t\t\tscript.parentNode.removeChild(script)\n\t\t}\n\t}\n}\n"],"names":["isBrowser","window","document","isObject","value","Object","prototype","toString","call","slice","toLowerCase","getType","log","prefix","_log","args","console","warn","error","UnityWebglEvent","constructor","this","_e","dispatchUnityEvent","name","startsWith","emit","on","listener","options","TypeError","once","onceListener","off","apply","_","push","listeners","filter","l","forEach","clear","addUnityListener","removeUnityListener","createUnityArgs","ctx","config","unityArgs","obj","keys","result","assign","key","omit","print","msg","printError","canvas","super","_unity","_loader","_canvas","HTMLCanvasElement","loaderUrl","dataUrl","frameworkUrl","codeUrl","_config","render","create","Promise","resolve","reject","$canvas","querySelector","queryCanvas","Error","src","callbacks","handler","code","script","getAttribute","setAttrListener","status","setAttribute","createElement","async","addEventListener","body","appendChild","parentNode","removeChild","unityLoader","createUnityInstance","val","then","ins","catch","err","sendMessage","objectName","methodName","SendMessage","_value","JSON","stringify","send","requestPointerLock","Module","takeScreenshot","dataType","quality","toDataURL","setFullscreen","enabled","SetFullscreen","unload","Quit","unsafe_unload","style","display","remove","e"],"mappings":"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"}